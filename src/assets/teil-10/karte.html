<!DOCTYPE html>
<html lang="en" mode="ios">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@geovistory/design-system-web@1.21.1-pr-121.0/dist/design-system-web/design-system-web.css" />
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@geovistory/design-system-web@1.21.1-pr-121.0/dist/design-system-web/design-system-web.esm.js"></script>
  <script nomodule
    src="https://cdn.jsdelivr.net/npm/@geovistory/design-system-web@1.21.1-pr-121.0/dist/design-system-web/design-system-web.js"></script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    geov-yasgui-map-circles {
      container-type: size;
      display: block;
      width: 100%;
      height: 100vh;
    }

    .yasgui .yasr {
      margin-top: 0px !important;
    }
    geov-yasgui > ion-button.toggle-button {
      display: none;
    }
  </style>
</head>

<body onload="init()">
  <geov-yasgui id="el-1" default-plugin="mapCircles" collapse="true" max-zoom="25" radius-min="4"
    radius-max="25"></geov-yasgui>


  <script>
    var queryTabs = [
      {
        name: 'Jüdische Handwerker und Israelit. Männerverein Dowor Tow',
        sparqlEndpoint: 'https://sparql.geovistory.org/api_v1_project_1719422',
        query: `
          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
          PREFIX ontome: <https://ontome.net/ontology/>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      PREFIX geov: <http://geovistory.org/resource/>
          SELECT
          (SAMPLE(?buildingLabel) as ?label)
          (CONCAT(
          '[',
              GROUP_CONCAT(CONCAT('{"label":"',?persName,'", "url":"',str(?person),'?p=1719422"}'); separator=', '),
              ']'
          ) as ?children)

          ?long ?lat ?link ?type
          (count(?link) * 0.5 as ?radius)
          WHERE {

          # Construction -had presence-> Presence -was at-> Place (lat/long)
          ?building ontome:p147i/ontome:p148 ?place.

          # Construction -label-> label
          ?building rdfs:label ?buildingLabel.

          # Construction -is location of-> Legal location of an Actor
          ?building ontome:p1851i ?location.

          # -is social quality of -> Person
          ?location ontome:p1411 ?person.

          ?person ontome:p1188i/ontome:p1189 ?group.
          ?group rdfs:label ?type.
          FILTER(?group = geov:i1972234 || ?group = geov:i1929590).

          # Person -label-> persName
          ?person rdfs:label ?persName.

          # Extract lat and long from WKT
          bind(replace(str(?place), '<http://www.opengis.net/def/crs/EPSG/0/4326>', "", "i") as ?rep)
          bind(xsd:float(replace(str(?rep), "^[^0-9\\\\.-]*([-]?[0-9\\\\.]+) .*$", "$1" )) as ?long )
          bind(xsd:float(replace( str(?rep), "^.* ([-]?[0-9\\\\.]+)[^0-9\\\\.]*$", "$1" )) as ?lat )

          # Append the project query param to the URI
          bind(concat(str(?building), "?p=1719422") as ?link )


          }
          GROUP BY ?building ?long ?lat ?type ?link

          `,
      },
    ]

    // Define a function to create elements for each queryTab
    function createQueryTabElement(id, queryTab) {
      var el = document.getElementById(id);
      if (!el) return;

      // Add props
      el['plugins'] = ['mapCircles'];
      el['pluginConfig'] = {
        mapCircles: { maxZoom: 25, radiusMin: 4, radiusMax: 25 },
      }
      el['queryTabs'] = [queryTab];
    }

    function init() {
      // Create separate elements for each queryTab
      queryTabs.forEach(function (queryTab, index) {
        createQueryTabElement('el-' + (index + 1), queryTab);
      });
    }
  </script>
</body>


</html>
